# QAレベル判定基準詳細

このドキュメントはQAレベル判定の詳細な基準を定義する。

---

## 1. 不具合発生可能性の判定基準

変更内容から不具合が発生する可能性を評価する。

### 低（係数: 1）

以下のいずれかに該当：

- **文言・テキスト変更のみ**
  - ボタンラベル、メッセージ、説明文の修正
  - 翻訳の追加・修正

- **設定値の変更**
  - 環境変数の追加・変更（ロジックに影響なし）
  - 設定ファイルの値変更

- **単純なUI修正**
  - CSSスタイルの調整
  - レイアウトの微調整
  - アイコン・画像の差し替え

- **ドキュメント・コメントのみ**
  - READMEの更新
  - コードコメントの追加・修正

### 中（係数: 2）

以下のいずれかに該当：

- **ビジネスロジックの変更**
  - 条件分岐の追加・変更
  - バリデーションルールの変更
  - 計算ロジックの修正

- **API関連の変更**
  - エンドポイントの追加・変更
  - リクエスト/レスポンス形式の変更
  - エラーハンドリングの変更

- **DB操作の変更**
  - クエリの修正
  - データ取得・保存ロジックの変更
  - トランザクション処理の変更

- **状態管理の変更**
  - Reduxストア、Context等の変更
  - セッション管理の変更

### 高（係数: 3）

以下のいずれかに該当：

- **複数機能にまたがる変更**
  - 共通コンポーネント/ライブラリの修正
  - 複数のAPIに影響する変更
  - データモデルの構造変更

- **新機能の追加**
  - 新しい画面・ページの追加
  - 新しいAPIエンドポイントの追加
  - 新しいビジネスフローの実装

- **大規模リファクタリング**
  - アーキテクチャの変更
  - フレームワーク/ライブラリのアップグレード
  - 大量のファイル変更（目安: 20ファイル以上）

---

## 2. リスク観点の詳細

### 決済・課金（係数: +3）

**該当条件:**
- 決済処理のコードを変更
- 課金計算ロジックを変更
- 請求書・領収書の生成処理を変更
- サブスクリプション管理の変更
- ポイント・クーポン処理の変更

**リスク:**
- 誤課金による金銭的損失
- 二重課金
- 課金漏れ

### 個人情報（係数: +3）

**該当条件:**
- 氏名、住所、電話番号等の処理変更
- メールアドレスの取り扱い変更
- パスワード関連の処理変更
- クレジットカード情報の取り扱い
- マイナンバー等の機微情報
- ログ出力内容の変更（個人情報含む可能性）

**リスク:**
- 情報漏洩
- プライバシー侵害
- 法的制裁（個人情報保護法違反）

### 外部連携（係数: +2）

**該当条件:**
- 外部APIの呼び出し処理変更
- Webhook処理の変更
- ファイル連携処理の変更
- メール/SMS送信処理の変更
- 外部サービスとの認証処理変更

**リスク:**
- 連携先システムへの障害波及
- データ不整合
- サービス停止

### DBスキーマ変更（係数: +2）

**該当条件:**
- テーブルの追加・削除
- カラムの追加・変更・削除
- インデックスの変更
- 外部キー制約の変更
- マイグレーションの追加

**リスク:**
- データ消失
- パフォーマンス劣化
- ロールバック困難

### 認証・認可（係数: +2）

**該当条件:**
- ログイン処理の変更
- セッション管理の変更
- 権限チェックロジックの変更
- OAuth/OIDC連携の変更
- 多要素認証の変更
- APIキー/トークン管理の変更

**リスク:**
- 不正アクセス
- 権限昇格
- セッションハイジャック

### 広範囲影響（係数: +1）

**該当条件:**
- 共通ライブラリ/ユーティリティの変更
- ベースクラス/抽象クラスの変更
- 設定ファイルの構造変更
- ルーティング設定の変更
- グローバルステートの変更

**リスク:**
- 予期しない箇所での不具合
- リグレッション

---

## 3. スコア計算式

### 計算式

```
総合スコア = 不具合発生可能性係数 × (1 + Σリスク観点係数)
```

### 計算例

#### 例1: 文言変更のみ
- 不具合発生可能性: 低（係数1）
- リスク観点: なし
- **総合スコア = 1 × (1 + 0) = 1点**

#### 例2: API修正（外部連携あり）
- 不具合発生可能性: 中（係数2）
- リスク観点: 外部連携（+2）
- **総合スコア = 2 × (1 + 2) = 6点**

#### 例3: 決済処理の新機能追加
- 不具合発生可能性: 高（係数3）
- リスク観点: 決済・課金（+3）、外部連携（+2）
- **総合スコア = 3 × (1 + 3 + 2) = 18点**

#### 例4: ユーザー登録フローの変更
- 不具合発生可能性: 中（係数2）
- リスク観点: 個人情報（+3）、認証・認可（+2）
- **総合スコア = 2 × (1 + 3 + 2) = 12点**

---

## 4. QAレベル判定基準表

### テスト実施者

| スコア | 実施者 | 理由 |
|--------|--------|------|
| 1-2 | 実装者以外 | 第三者視点での確認で十分 |
| 3-5 | 実装者以外 | より慎重なテストが必要 |
| 6-9 | QA担当 | 専門的なテストスキルが必要 |
| 10+ | QAリード | 高度な判断力と経験が必要 |

### ダブルチェック

| スコア | ダブルチェック | 詳細 |
|--------|----------------|------|
| 1-2 | なし | 単一担当者で十分 |
| 3-5 | あり（実装者可） | 2名以上で確認 |
| 6-9 | あり（QA担当） | QA担当者による再確認 |
| 10+ | 複数人確認 | 3名以上での確認推奨 |

### テスト内容

| スコア | テスト範囲 |
|--------|-----------|
| 1-2 | 正常系のみ |
| 3-5 | 正常系 + 主要な異常系 |
| 6-9 | 正常系 + 異常系 + 境界値 |
| 10+ | 全パターン + 負荷テスト検討 |

### テスト観点レビュー

| スコア | レビュー体制 |
|--------|-------------|
| 1-2 | 観点作成者以外ならOK |
| 3-5 | 別担当者必須 |
| 6-9 | QAリード確認必須 |
| 10+ | チーム全体レビュー |

---

## 5. 判定早見表

### リスクレベル別の対応一覧

```
┌─────────┬────────┬─────────────┬──────────────────┬────────────────────┐
│ スコア  │ レベル │ テスト実施者 │ ダブルチェック    │ テスト観点レビュー   │
├─────────┼────────┼─────────────┼──────────────────┼────────────────────┤
│  1-2    │  低    │ 実装者以外  │ なし             │ 観点作成者以外ならOK │
│  3-5    │  中    │ 実装者以外  │ あり（実装者可）  │ 別担当者必須        │
│  6-9    │  高    │ QA担当      │ あり（QA担当）    │ QAリード確認必須    │
│ 10+     │ 最高   │ QAリード    │ 複数人確認        │ チーム全体レビュー   │
└─────────┴────────┴─────────────┴──────────────────┴────────────────────┘
```

### よくあるパターン

| 変更内容 | 不具合可能性 | リスク観点 | スコア | レベル |
|----------|-------------|-----------|--------|--------|
| 文言修正 | 低(1) | なし | 1 | 低 |
| UI修正（CSS） | 低(1) | なし | 1 | 低 |
| バリデーション追加 | 中(2) | なし | 2 | 低 |
| API修正 | 中(2) | なし | 2 | 低 |
| API修正（外部連携） | 中(2) | +2 | 6 | 高 |
| ログイン処理変更 | 中(2) | +2 | 6 | 高 |
| 決済処理修正 | 中(2) | +3 | 8 | 高 |
| 新機能追加 | 高(3) | なし | 3 | 中 |
| 新機能（決済関連） | 高(3) | +3 | 12 | 最高 |
| DBマイグレーション | 中(2) | +2 | 6 | 高 |
| 共通ライブラリ変更 | 高(3) | +1 | 6 | 高 |

---

## 6. 特記事項

### スコアの調整

以下の場合はスコアを調整することを検討：

**減点要素（-1〜-2）:**
- 十分なユニットテストがある
- 変更範囲が限定的で影響が明確
- ロールバック手順が確立されている

**加点要素（+1〜+2）:**
- 本番環境のみで発生する問題の可能性
- 過去に問題が発生した箇所
- テスト環境での再現が困難

### 緊急リリース時の対応

緊急リリース（ホットフィックス）の場合でも、このスコアリングは適用する。
ただし、リスクレベルに応じた承認プロセスを短縮することはできない。
